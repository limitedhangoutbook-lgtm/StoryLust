WILD BRANCH - REPOSITORY TREE SNAPSHOT
Generated: August 18, 2025
========================================

## PROJECT OVERVIEW
Wild Branch: Progressive Web App for Choose Your Own Adventure erotica stories
- TypeScript full-stack with React frontend and Express backend  
- Neon PostgreSQL database with Drizzle ORM
- Stripe payments for virtual eggplant currency
- Replit OIDC authentication
- Mobile-first PWA design with Kindle-like reading experience

## REPOSITORY STRUCTURE

```
wild-branch/
â”œâ”€â”€ README.md                           # Project documentation
â”œâ”€â”€ replit.md                          # User preferences and architecture guide
â”œâ”€â”€ ARCHITECTURE_ROADMAP.md            # Future development plans
â”œâ”€â”€ PROJECT_EXPORT.md                  # Export documentation
â”œâ”€â”€ QUICK_SHARE.md                     # Quick sharing guide
â”œâ”€â”€ SAFE_SHARING_GUIDE.md              # Security guidelines
â”œâ”€â”€ REPO_TREE_SNAPSHOT.txt             # This file
â”œâ”€â”€ .replit                            # Replit configuration
â”œâ”€â”€ .gitignore                         # Git ignore rules
â”œâ”€â”€ package.json                       # Node.js dependencies
â”œâ”€â”€ package-lock.json                  # Dependency lock file
â”œâ”€â”€ tsconfig.json                      # TypeScript configuration
â”œâ”€â”€ vite.config.ts                     # Vite build configuration
â”œâ”€â”€ tailwind.config.ts                 # Tailwind CSS configuration
â”œâ”€â”€ postcss.config.js                  # PostCSS configuration
â”œâ”€â”€ components.json                    # shadcn/ui configuration
â”œâ”€â”€ drizzle.config.ts                  # Database configuration
â”œâ”€â”€ cookies.txt                        # Cookie storage
â”‚
â”œâ”€â”€ attached_assets/                   # User-uploaded assets
â”‚   â”œâ”€â”€ 4ede2b78-0430-438b-a2b0-634185b25430_1753816580839.jpg
â”‚   â”œâ”€â”€ 5015ddb8-30c3-4c4d-a548-486218303f47_1753816580842.jpg
â”‚   â”œâ”€â”€ Flow Chart Decision Maker_1754617668303.pdf
â”‚   â”œâ”€â”€ Pasted--Architecture-Good-Folder-structure-is-clean-and-scalable-Use-of-Drizzle-Neon-modern-so-1754179336397_1754179336398.txt
â”‚   â”œâ”€â”€ Pasted-Nice-Graphin-is-a-solid-pick-Here-s-a-dead-simple-way-to-get-a-pretty-auto-laid-out-story-map-runn-1754636530141_1754636530142.txt
â”‚   â”œâ”€â”€ Screenshot_20250729_010854_Replit_1753769348155.jpg
â”‚   â”œâ”€â”€ Screenshot_20250729_015839_Replit_1753772330874.jpg
â”‚   â”œâ”€â”€ Screenshot_20250729_201740_Replit_1753838274423.jpg
â”‚   â”œâ”€â”€ Screenshot_20250731_194808_Replit_1754009303593.jpg
â”‚   â”œâ”€â”€ davidbook_1753815404952.png
â”‚   â””â”€â”€ image-2689324906983284140_1753765559041_1754184409117.jpg
â”‚
â”œâ”€â”€ client/                           # React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx                   # Main app component with routing
â”‚   â”‚   â”œâ”€â”€ index.css                 # Global styles and theme variables
â”‚   â”‚   â”œâ”€â”€ main.tsx                  # React entry point
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/               # Reusable UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ chat-message-renderer.tsx    # Story content renderer
â”‚   â”‚   â”‚   â”œâ”€â”€ SpendButton.tsx              # Hold-to-confirm premium button
â”‚   â”‚   â”‚   â”œâ”€â”€ SimpleSpendButton.tsx        # Simplified premium button (current)
â”‚   â”‚   â”‚   â”œâ”€â”€ StoryJumpMenu.tsx            # Navigation jump menu
â”‚   â”‚   â”‚   â”œâ”€â”€ theme-provider.tsx           # Dark/light theme context
â”‚   â”‚   â”‚   â””â”€â”€ ui/                          # shadcn/ui component library
â”‚   â”‚   â”‚       â”œâ”€â”€ accordion.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ alert-dialog.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ form.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ label.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ popover.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ scroll-area.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ separator.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ sheet.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ skeleton.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ switch.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ toast.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ toaster.tsx
â”‚   â”‚   â”‚       â””â”€â”€ tooltip.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hooks/                    # Custom React hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ use-toast.ts         # Toast notification hook
â”‚   â”‚   â”‚   â””â”€â”€ use-theme.ts         # Theme management hook
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ lib/                     # Utility libraries
â”‚   â”‚   â”‚   â”œâ”€â”€ queryClient.ts       # TanStack Query configuration
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts             # General utility functions
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ pages/                   # Page components
â”‚   â”‚       â”œâ”€â”€ admin-dashboard.tsx           # Admin management interface
â”‚   â”‚       â”œâ”€â”€ buy-diamonds.tsx              # Diamond purchase page
â”‚   â”‚       â”œâ”€â”€ home.tsx                      # Landing page
â”‚   â”‚       â”œâ”€â”€ library.tsx                   # Story library/catalog
â”‚   â”‚       â”œâ”€â”€ profile.tsx                   # User profile page
â”‚   â”‚       â”œâ”€â”€ story-reader-pages.tsx        # Main story reading interface
â”‚   â”‚       â””â”€â”€ write-story.tsx               # Story creation interface
â”‚   â”‚
â”‚   â””â”€â”€ public/                      # Static assets
â”‚       â”œâ”€â”€ favicon.ico
â”‚       â”œâ”€â”€ manifest.json            # PWA manifest
â”‚       â””â”€â”€ service-worker.js        # PWA service worker
â”‚
â”œâ”€â”€ server/                          # Express.js backend
â”‚   â”œâ”€â”€ index.ts                     # Main server entry point
â”‚   â”œâ”€â”€ vite.ts                      # Vite development server setup
â”‚   â”œâ”€â”€ auth.ts                      # Authentication middleware and handlers
â”‚   â”œâ”€â”€ routes.ts                    # API route definitions
â”‚   â”œâ”€â”€ storage.ts                   # Database operations layer
â”‚   â”œâ”€â”€ db.ts                        # Database connection and schema
â”‚   â”‚
â”‚   â”œâ”€â”€ adapters/                    # External service adapters
â”‚   â”‚   â””â”€â”€ stripe.ts               # Stripe payment integration
â”‚   â”‚
â”‚   â”œâ”€â”€ analytics/                   # Analytics and tracking
â”‚   â”‚   â””â”€â”€ events.ts               # Event tracking definitions
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                        # Authentication modules
â”‚   â”‚   â”œâ”€â”€ middleware.ts           # Auth middleware
â”‚   â”‚   â””â”€â”€ providers.ts            # OAuth providers (Replit OIDC)
â”‚   â”‚
â”‚   â”œâ”€â”€ engines/                     # Story processing engines
â”‚   â”‚   â”œâ”€â”€ story-engine.ts         # Core story logic
â”‚   â”‚   â””â”€â”€ choice-engine.ts        # Choice processing logic
â”‚   â”‚
â”‚   â””â”€â”€ services/                    # Business logic services
â”‚       â”œâ”€â”€ story-service.ts        # Story management
â”‚       â”œâ”€â”€ user-service.ts         # User management  
â”‚       â”œâ”€â”€ payment-service.ts      # Payment processing
â”‚       â””â”€â”€ progress-service.ts     # Reading progress tracking
â”‚
â””â”€â”€ shared/                         # Shared TypeScript types
    â”œâ”€â”€ schema.ts                   # Drizzle database schema
    â””â”€â”€ types.ts                    # Shared type definitions
```

## KEY FILES BREAKDOWN

### Core Configuration
- `package.json` - Dependencies: React 18, Express, Drizzle ORM, Stripe, TanStack Query
- `vite.config.ts` - Development server configuration with proxy
- `tailwind.config.ts` - Custom theme with eggplant purple, rose-gold accents
- `drizzle.config.ts` - Database configuration for Neon PostgreSQL

### Frontend Architecture
- `client/src/App.tsx` - Wouter routing, authentication context
- `client/src/pages/story-reader-pages.tsx` - Main story reader with swipe navigation
- `client/src/components/SimpleSpendButton.tsx` - Premium choice confirmation modal
- `client/src/components/StoryJumpMenu.tsx` - Jump navigation system
- `client/src/index.css` - Dark Kindle theme, typography, custom CSS variables

### Backend Architecture  
- `server/index.ts` - Express server setup, middleware, session management
- `server/auth.ts` - Replit OIDC authentication, user creation/updates
- `server/routes.ts` - RESTful API endpoints for stories, choices, payments
- `server/storage.ts` - Database operations with Drizzle ORM
- `server/db.ts` - Database schema and connection

### Database Schema (shared/schema.ts)
- `users` - Authentication, eggplant balance, reading preferences
- `stories` - Story metadata, categories, spice levels
- `storyNodes` - Individual story pages with content
- `storyChoices` - Choice options with premium costs
- `readingProgress` - User reading position tracking
- `userChoices` - User choice selections and purchase history
- `sessions` - Authentication session storage

## CURRENT STATE
- **Version**: V1.2 Streamlined Navigation
- **Status**: Production-ready core functionality
- **Recent Updates**: 
  - Replaced hold-to-confirm with simple click premium buttons
  - Added soft confirmation modal with eggplant theme
  - Fixed login-to-premium-purchase flow
  - All LSP errors resolved, debug statements removed

## AUTHENTICATION FLOW
1. Guest browsing with free content access
2. Premium choices show "Sign In to Unlock" buttons
3. `/api/login` handles Replit OIDC authentication
4. Automatic user creation/profile updates
5. Session persistence with PostgreSQL store
6. Premium content unlocked after eggplant purchase

## PREMIUM CONTENT SYSTEM
- Virtual eggplant currency (ğŸ†) purchased with Stripe
- Choice-based premium unlocks (not page-based)
- Persistent access to purchased premium paths
- Configurable eggplant costs per choice
- Balance tracking and purchase history

## MOBILE-FIRST DESIGN
- Progressive Web App (PWA) with service worker
- Touch-optimized swipe navigation
- Bottom navigation bar
- Kindle-like dark reading theme
- Professional serif typography options
- Responsive design for all screen sizes